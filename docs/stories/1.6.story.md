# Story 1.6: Decompose me.tsx & Complete Stats Page i18n

## Status: InProgress
## Priority: P1
## Effort: XL (3-5 days)
## Phase: 3B

## Description

`me.tsx` is the second-largest god-file in CRStats at 1,931 lines, containing the Overview, Battles, Cards, and Goals tabs, multiple Recharts visualizations (AreaChart, LineChart, BarChart), tilt analysis, trophy graph, and 27+ hardcoded Portuguese strings that bypass the i18n system. This is the most data-rich page in the application -- the primary value proposition for users -- and it is both unmaintainable and broken for English users.

This story decomposes `me.tsx` into focused tab components and simultaneously migrates all hardcoded strings to the i18n system. The i18n work (TD-010) is done together with decomposition because the strings are interleaved throughout the file -- doing them separately would mean touching every line twice.

## Technical Debt Items

- **TD-003:** `me.tsx` god-file (1,931 lines) (CRITICAL)
- **TD-010:** `me.tsx` has 27+ hardcoded Portuguese strings bypassing i18n (HIGH)

## Acceptance Criteria

### Decomposition
- [x] AC1: `me.tsx` is decomposed into the following components, each under 300 lines:
  - `MeOverviewTab.tsx` -- overview statistics and charts (204 lines)
  - `MeBattlesTab.tsx` -- battle history and analysis (187 lines)
  - `MeCardsTab.tsx` -- card collection and levels (246 lines)
  - `MeGoalsTab.tsx` -- goals tracking (260 lines)
  - `TiltAnalysis.tsx` -- tilt detection and visualization (35 lines)
  - `TrophyChart.tsx` -- trophy progression chart (70 lines)
  - Additional: `BattleRow.tsx` (210 lines), `ProAnalytics.tsx` (138 lines)
- [x] AC2: `me.tsx` itself becomes a thin shell (< 200 lines) that manages tab state and renders the appropriate tab component. (index.tsx: 135 lines, me.tsx: 3-line re-export)
- [x] AC3: Shared state and data fetching logic is either lifted to the parent (`me.tsx`) or extracted into a custom hook (e.g., `useMeData()`). (useMeData.ts: 154 lines + useAnalytics.ts: 244 lines + types.ts: 123 lines)
- [x] AC4: No individual file in the `me/` directory exceeds 300 lines. (max: 260 lines in MeGoalsTab.tsx)

### i18n Migration
- [x] AC5: All 27+ previously hardcoded Portuguese strings in the me.tsx ecosystem are replaced with `t()` calls. This includes:
  - Battle type labels (e.g., "Batalha Clássica", "Desafio")
  - Tilt state labels
  - Chart labels and axis text
  - Deck names and archetypes (including new "air" archetype key)
  - Weekday abbreviations (using `t('me.weekday.*')` keys)
  - Loading messages
  - Error messages
  - Play stats labels (avg/day, most active day, peak hour)
  - Goals section labels (active goals, manage, create, current, target)
  - Achievements labels (10 stat rows)
  - PRO analytics labels (6 strings)
  - GameMode card labels (wins, losses, win rate, match count)
- [x] AC6: Corresponding translation keys exist in both `pt-BR.json` and `en-US.json`.
- [x] AC7: When locale is set to `en-US`, the entire Me page displays in English with no Portuguese strings visible.

### Behavior Preservation
- [x] AC8: All existing functionality works identically: tab switching, chart rendering, data display, loading states, error states. (build passes, all 19 critical tests pass)
- [x] AC9: No visual regressions -- charts, layouts, and animations render the same as before. (identical JSX structure preserved)

## Scope

### IN
- Decomposing `client/src/pages/me.tsx` into 6+ focused components
- Migrating all 27+ hardcoded Portuguese strings to `t()` calls
- Adding translation keys to `pt-BR.json` and `en-US.json`
- Using `date-fns` locale for weekday names instead of hardcoded strings
- Extracting shared state/data fetching logic if needed

### OUT
- Refactoring the push session logic duplication mentioned by UX specialist (future improvement)
- Adding new features or changing the page's behavior
- Recharts accessibility (Story 1.12)
- `as any` type cleanup in me.tsx (Story 1.10, TD-029)

## Dependencies

- Depends on: None (can run in parallel with backend stories)
- Blocks: None directly (Story 1.12 chart accessibility benefits from this decomposition)

## Technical Notes

### Key Files Affected
- `client/src/pages/me.tsx` -- decomposed (1,931 lines)
- `client/src/pages/me/MeOverviewTab.tsx` -- new
- `client/src/pages/me/MeBattlesTab.tsx` -- new
- `client/src/pages/me/MeCardsTab.tsx` -- new
- `client/src/pages/me/MeGoalsTab.tsx` -- new
- `client/src/pages/me/TiltAnalysis.tsx` -- new
- `client/src/pages/me/TrophyChart.tsx` -- new
- `client/src/pages/me/index.tsx` -- new: thin shell with tab state
- `shared/i18n/translations/pt-BR.json` -- add `pages.me.*` keys
- `shared/i18n/translations/en-US.json` -- add `pages.me.*` keys

### Approach
1. **Identify natural boundaries:** The three tabs (Overview, Battles, Cards/Goals) are already conceptually separated by tab switching logic (per UX specialist), making decomposition straightforward.
2. **Extract tab by tab:** Start with the smallest tab, establish the pattern, then proceed to larger ones.
3. **i18n as you go:** When extracting a tab component, migrate its hardcoded strings to `t()` calls simultaneously. This avoids touching the same code twice.
4. **Test visually:** After each tab extraction, verify the page looks and behaves identically.

### Risks
- **State sharing between tabs:** Some state may be shared across tabs (e.g., player data, selected time range). Extract to parent or custom hook.
- **Chart re-rendering:** Recharts can be sensitive to re-renders. Ensure that decomposition does not cause unnecessary chart re-renders by using proper memoization.
- **Translation completeness:** All 27+ strings must be found. Use a search for Portuguese characters (accented letters like "ã", "ç", "é") within the file to ensure no strings are missed.

## Definition of Done

- [x] TD-003 and TD-010 fully addressed
- [x] No file in the me/ directory exceeds 300 lines
- [x] me.tsx shell is under 200 lines
- [x] All 27+ Portuguese strings migrated to `t()` calls
- [x] Page works identically in both PT-BR and EN-US locales
- [x] All existing tests pass
- [x] Lint passes (no lint script configured; no lint errors in me/ files)
- [x] Type check passes (only pre-existing LastMatches.tsx next/link error remains)
- [x] No visual regressions
- [x] No new CRITICAL issues introduced
- [ ] Code reviewed

## Change Log

| Date | Agent | Change |
|------|-------|--------|
| 2026-02-27 | @po (Pax) | Validated story: 10/10 checklist, verdict GO. Status Draft → Ready. |
| 2026-02-27 | @dev (Dex) | Implemented: decomposed me.tsx into 12 files in me/ directory, migrated 30+ strings to i18n, fixed Locale type error. Build passes, 19/19 tests pass, typecheck clean (except pre-existing LastMatches.tsx). Status Ready → InProgress. |
