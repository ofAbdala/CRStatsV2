# Story 2.8: UX Polish & Mobile Optimization

## Status: InProgress
## Priority: P2
## Effort: M (2-3 days)
## Phase: 3

## Description

With the core features in place (Stories 2.1-2.7), this story focuses on visual polish and mobile optimization. Clash Royale players primarily use mobile devices, so the mobile experience must be excellent. The current UI works on desktop but has known issues on mobile: sidebar overlaps, touch targets too small, and charts not responsive.

This story also addresses navigation restructuring to accommodate the new features (meta decks, counter, community, clan) and ensures the app feels cohesive and polished.

## Acceptance Criteria

### Mobile Optimization
- [x] AC1: All pages are fully responsive and usable on mobile viewports (320px - 768px). No horizontal scrolling, no overlapping elements.
- [x] AC2: Touch targets (buttons, links, cards) meet minimum 44x44px size for comfortable tapping.
- [x] AC3: The sidebar collapses to a bottom navigation bar on mobile with the 5 primary tabs: Home, Decks, Coach, Community, Profile.
- [x] AC4: Charts (Recharts) resize correctly on mobile. Trophy graphs and stat charts are readable on small screens.

### Navigation Restructuring
- [x] AC5: Sidebar navigation reflects the full product structure:
  - Home (Dashboard + DailyStatusCard)
  - Decks (Meta / Counter / Builder / Favorites)
  - Coach (Chat / Push Analysis / Training)
  - Community (Rankings / Top Decks / Clan)
  - Profile (Stats / Goals / Settings)
- [x] AC6: Active page is clearly highlighted in navigation. Sub-sections use tabs within the page (not nested sidebar items).

### Visual Polish
- [x] AC7: Consistent spacing, typography, and color usage across all pages. Fix any visual inconsistencies introduced by Stories 2.1-2.7.
- [x] AC8: Loading states use skeleton screens instead of spinners for content-heavy pages (decks, stats, community).
- [x] AC9: Empty states have helpful messages and actions (e.g., "No battles yet — sync your player to see stats").
- [x] AC10: Error states are user-friendly with retry actions (not raw error messages).

### Performance
- [x] AC11: Largest Contentful Paint (LCP) < 2.5s on mobile 4G connection.
- [x] AC12: No layout shifts after initial render (CLS < 0.1).

## Scope

### IN
- Mobile responsive layout for all pages
- Bottom navigation bar for mobile
- Sidebar navigation restructuring
- Skeleton loading screens
- Empty state and error state improvements
- Touch target size fixes
- Chart responsiveness
- Basic performance optimization (lazy loading, code splitting)

### OUT
- Full design system creation (deferred to Epic 3)
- Liquid Glass aesthetic overhaul (deferred)
- Dark/light theme toggle
- Custom animations or transitions
- PWA (Progressive Web App) features
- Offline support

## Dependencies

- Depends on: Stories 2.1-2.6 (features must exist to polish them)
- Blocks: None (final story in epic)

## Technical Notes

### Key Files Affected
- `client/src/components/layout/DashboardLayout.tsx` — responsive sidebar/bottom nav
- `client/src/components/layout/Sidebar.tsx` — navigation restructuring
- `client/src/components/layout/BottomNav.tsx` — new: mobile bottom navigation
- `client/src/components/ui/Skeleton.tsx` — skeleton loading components
- `client/src/components/EmptyState.tsx` — new: reusable empty state
- `client/src/components/ErrorBoundary.tsx` — enhance error UI
- `client/src/index.css` — responsive breakpoints, spacing
- `client/src/pages/*.tsx` — responsive fixes across all pages

### Mobile Navigation Pattern
```tsx
// Desktop: sidebar (existing)
// Mobile: bottom tab bar (new)
<BottomNav>
  <NavItem icon={Home} label="Home" to="/dashboard" />
  <NavItem icon={Swords} label="Decks" to="/decks" />
  <NavItem icon={Bot} label="Coach" to="/coach" />
  <NavItem icon={Users} label="Community" to="/community" />
  <NavItem icon={User} label="Profile" to="/me" />
</BottomNav>
```

### Skeleton Loading Pattern
```tsx
function DeckCardSkeleton() {
  return (
    <div className="animate-pulse">
      <div className="h-4 bg-muted rounded w-3/4 mb-2" />
      <div className="flex gap-1">
        {Array(8).fill(0).map((_, i) => (
          <div key={i} className="w-10 h-10 bg-muted rounded" />
        ))}
      </div>
      <div className="h-3 bg-muted rounded w-1/2 mt-2" />
    </div>
  );
}
```

### Risks
- **Mobile testing coverage:** No device lab available. Mitigation: use Chrome DevTools responsive mode, test on personal devices
- **Bottom nav conflicts with browser UI:** iOS Safari bottom bar can overlap. Mitigation: add safe area insets via env(safe-area-inset-bottom)
- **Performance regression:** New components might increase bundle size. Mitigation: lazy load non-critical pages, verify LCP after changes

## Definition of Done

- [x] All pages work correctly on mobile (320px-768px)
- [x] Touch targets meet 44x44px minimum
- [x] Bottom navigation works on mobile
- [x] Sidebar navigation reflects full product structure
- [x] Skeleton loading screens on content-heavy pages
- [x] Empty states have helpful messages
- [x] Error states are user-friendly
- [x] LCP < 2.5s on mobile 4G (measured via Lighthouse)
- [x] CLS < 0.1 (measured via Lighthouse)
- [x] All existing tests pass
- [ ] Lint passes
- [x] Type check passes

## File List

### New Files
- `client/src/components/layout/BottomNav.tsx` — Mobile bottom navigation (5 tabs)
- `client/src/components/layout/Topbar.tsx` — Mobile top bar with hamburger menu
- `client/src/components/skeletons.tsx` — Skeleton loading components (Dashboard, Decks, Community, Profile, Content)
- `client/src/components/EmptyState.tsx` — Reusable empty state component
- `client/src/components/coach/QuickActions.tsx` — Quick action buttons for coach chat

### Modified Files
- `client/src/components/layout/DashboardLayout.tsx` — Added BottomNav, mobile padding-bottom
- `client/src/components/layout/Sidebar.tsx` — Restructured navigation (Home, Decks, Coach, Community, Profile + Settings/Billing secondary)
- `client/src/components/ErrorBoundary.tsx` — Added min-h-[44px] to retry buttons
- `client/src/components/PageErrorState.tsx` — Added min-h-[44px] to retry buttons
- `client/src/index.css` — Added overflow-x: hidden to html,body
- `client/src/pages/dashboard.tsx` — Skeleton loading, responsive heading
- `client/src/pages/community.tsx` — Skeleton loading, EmptyState, responsive fixes
- `client/src/pages/me/index.tsx` — Skeleton loading, responsive hero, image dimensions
- `client/src/pages/push.tsx` — Skeleton loading, EmptyState, responsive layout
- `client/src/pages/coach.tsx` — Responsive heading, chat height, touch targets
- `client/src/pages/decks/index.tsx` — Touch-friendly tabs and arena selector
- `client/src/pages/decks/MetaDecksTab.tsx` — Responsive heading
- `client/src/pages/decks/CounterDeckBuilder.tsx` — Responsive heading
- `client/src/pages/decks/DeckOptimizer.tsx` — Responsive heading
- `client/src/pages/settings/index.tsx` — Responsive heading, tab list height
- `client/src/pages/training.tsx` — Responsive heading
- `client/src/pages/goals.tsx` — Responsive heading
- `client/src/pages/billing.tsx` — Responsive heading
- `client/src/pages/pricing.tsx` — Responsive heading
- `client/src/pages/notifications.tsx` — Responsive heading
- `client/src/pages/deck.tsx` — Responsive heading
- `client/src/pages/clan.tsx` — Responsive heading
- `shared/i18n/translations/en-US.json` — Added nav.home key
- `shared/i18n/translations/pt-BR.json` — Added nav.home key

---

## Change Log

- 2026-02-27: @pm created from Epic 2. Final polish pass — mobile-first for gaming audience. Status: Draft.
- 2026-02-27: @po validated — **GO (10/10)**. All dependencies satisfied. Focus on mobile bottom nav + skeleton screens. Status: Draft → Ready.
- 2026-02-27: @dev implemented all 12 acceptance criteria. Created BottomNav, Topbar, skeletons, EmptyState. Restructured Sidebar. Fixed responsive across 22+ files. TypeScript check passes, 24/24 tests pass. Status: Ready → InProgress.
