# Story 2.3: SEO Dynamic Pages & Public Profiles

## Status: Draft
## Priority: P0
## Effort: M (2-3 days)
## Phase: 1

## Description

Every player who searches "best deck arena 15" or "counter Golem Clash Royale" on Google is a potential user. Currently, CRStats is a SPA with zero SEO presence — search engines can't index any content. This story creates dynamic, server-rendered pages for every arena and every card, turning the meta deck and counter data (Story 2.1) into an infinite organic acquisition engine.

As @atena-c recommended: "O público não precisa ser convencido que precisa do produto — ele já tá buscando essa informação. Tu só precisa ser onde ele busca."

## Acceptance Criteria

### Meta Pages by Arena
- [ ] AC1: Pages exist at `/meta/{arena-slug}` (e.g., `/meta/arena-15`, `/meta/legendary-arena`) for each arena (minimum 10 arenas).
- [ ] AC2: Each meta page displays: top 10 decks for that arena with win rate, usage rate, 3-crown rate, sample size. Data comes from the meta pipeline (Story 2.1).
- [ ] AC3: Meta pages are server-side rendered (SSR) or pre-rendered with proper HTML content for search engine crawling.

### Counter Pages by Card
- [ ] AC4: Pages exist at `/counter/{card-slug}` (e.g., `/counter/golem`, `/counter/mega-knight`) for each card (minimum top 30 cards).
- [ ] AC5: Each counter page displays: top 5-10 decks with highest win rate against that card, filterable by arena. Data comes from the counter engine (Story 2.1).
- [ ] AC6: Counter pages include a brief description of the card and why these counters work (can be AI-generated once, cached).

### Public Player Profiles
- [ ] AC7: Public profile pages exist at `/player/{tag}` showing player stats, current deck, trophy history, and recent battles. Accessible without authentication.
- [ ] AC8: Public profiles have proper Open Graph meta tags for social sharing (title, description, image with player stats).

### SEO Infrastructure
- [ ] AC9: All dynamic pages have proper `<title>`, `<meta description>`, `<meta og:*>` tags with relevant keywords (e.g., "Best Decks for Arena 15 - CRStats").
- [ ] AC10: A sitemap.xml is generated automatically listing all meta, counter, and public profile pages. Updated daily.
- [ ] AC11: robots.txt allows crawling of all public pages while blocking authenticated routes.
- [ ] AC12: Canonical URLs are set correctly to avoid duplicate content issues.

## Scope

### IN
- Server-side rendering or pre-rendering for public pages
- Dynamic route generation for arenas, cards, and player profiles
- SEO meta tags and Open Graph support
- Sitemap.xml generation
- robots.txt configuration
- Structured data (JSON-LD) for rich search results

### OUT
- Blog or editorial content pages
- Multi-language SEO (English pages — deferred)
- Google Search Console integration (manual setup)
- Link building or off-page SEO
- AMP pages
- Social media auto-posting

## Dependencies

- Depends on: Story 2.1 (meta/counter data), Story 2.2 (production deployment)
- Blocks: None

## Technical Notes

### Key Files Affected
- `server/routes/public.ts` — expand with meta/counter/profile page routes
- `server/routes/seo.ts` — new: sitemap.xml, robots.txt generation
- `client/src/pages/meta-arena.tsx` — new: meta deck page per arena
- `client/src/pages/counter-card.tsx` — new: counter deck page per card
- `client/src/pages/public-profile.tsx` — new or expand existing
- `server/index.ts` — SSR middleware for public pages
- `vite.config.ts` — SSR or pre-render configuration

### SSR Approach Options
1. **Vercel Edge Functions + React SSR** — full server rendering per request
2. **ISR (Incremental Static Regeneration)** — pre-render + revalidate every hour
3. **Pre-render at build time** — generate static HTML for known arenas/cards

Recommended: **Option 2 (ISR)** — best balance of SEO + freshness + performance.

### URL Structure
```
/meta/arena-1          → "Best Decks for Goblin Stadium - CRStats"
/meta/arena-15         → "Best Decks for Arena 15 - CRStats"
/meta/legendary-arena  → "Best Decks for Legendary Arena - CRStats"
/counter/golem         → "Best Counter Decks for Golem - CRStats"
/counter/mega-knight   → "Best Counter Decks for Mega Knight - CRStats"
/player/ABC123         → "Player ABC123 Stats - CRStats"
/sitemap.xml           → Auto-generated sitemap
/robots.txt            → Crawling rules
```

### Structured Data (JSON-LD)
```json
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "Best Counter Decks for Golem - Arena 15",
  "description": "Top 10 decks with highest win rate against Golem in Arena 15. Updated daily from real battle data.",
  "dateModified": "2026-02-27"
}
```

### Risks
- **SSR complexity with Vite:** Vite SSR requires careful configuration. Mitigation: use vite-plugin-ssr or manual SSR setup
- **Vercel function size limits:** SSR bundles must be < 50MB. Mitigation: code splitting, lazy loading
- **Google indexing delay:** New sites take weeks to get indexed. Mitigation: submit sitemap via Search Console, share pages on Reddit/Discord
- **Stale content in cache:** ISR cache might serve outdated meta data. Mitigation: 1-hour revalidation interval

## Definition of Done

- [ ] Meta pages render for at least 10 arenas with real data
- [ ] Counter pages render for at least 30 cards with real data
- [ ] Public player profiles display stats correctly
- [ ] All public pages have proper SEO meta tags
- [ ] sitemap.xml is accessible and lists all pages
- [ ] robots.txt is configured correctly
- [ ] Pages pass Google's Mobile-Friendly Test
- [ ] Core Web Vitals are "Good" (LCP < 2.5s, CLS < 0.1)
- [ ] All existing tests pass (78 tests)
- [ ] Lint passes
- [ ] Type check passes

---

## Change Log

- 2026-02-27: @pm created from Epic 2 / Counsel Session #2. @atena-c identified SEO as primary acquisition channel. Status: Draft.
