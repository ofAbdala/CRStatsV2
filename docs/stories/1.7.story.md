# Story 1.7: Decompose decks.tsx into Feature Modules

## Status: Done
## Priority: P1
## Effort: L (1-3 days)
## Phase: 3B

## Description

`decks.tsx` is a 1,397-line god-file containing the Meta Decks tab, Counter-Deck Builder, and Deck Optimizer with complex inline state management. All UI, state logic, and data transformations are co-located in a single file. The three features are already conceptually separated by tab switching logic, making decomposition straightforward.

This decomposition makes the deck features independently testable and maintainable, and unblocks the Vision 2.0 "Deck Lab" redesign.

## Technical Debt Items

- **TD-002:** `decks.tsx` god-file (1,397 lines) (CRITICAL)

## Acceptance Criteria

- [x] AC1: `decks.tsx` is decomposed into the following components:
  - `MetaDecksTab.tsx` -- meta decks display and filtering
  - `CounterDeckBuilder.tsx` -- counter-deck suggestion UI
  - `DeckOptimizer.tsx` -- deck optimization UI
  - `DeckDisplay.tsx` -- shared deck card visualization component
  - `MetaCardStatsTable.tsx` -- card-level meta statistics table (bonus extraction)
  - `types.ts` -- shared types, constants, type guards, utilities
- [x] AC2: `decks.tsx` itself becomes a thin shell (< 200 lines) that manages tab state and renders the appropriate tab component. (index.tsx = 85 lines)
- [x] AC3: No individual file exceeds 400 lines. (max = 370 lines in DeckOptimizer.tsx)
- [x] AC4: All existing functionality works identically: tab switching, deck display, counter-deck suggestions, deck optimization, loading states, error states.
- [x] AC5: Shared types and utilities are extracted to a `decks/` directory or shared module. (types.ts = 271 lines)

## Scope

### IN
- Decomposing `client/src/pages/decks.tsx` into 4+ focused components
- Extracting shared state/data fetching logic
- Creating a shared `DeckDisplay` component for deck card visualization

### OUT
- Adding new deck features or changing behavior
- i18n work on the decks page (decks.tsx already uses `t()` properly)
- `as any` type cleanup in decks.tsx (Story 1.10, TD-029)
- Recharts accessibility in decks.tsx (Story 1.12)

## Dependencies

- Depends on: None (can run in parallel with backend stories and Story 1.6)
- Blocks: None directly

## Technical Notes

### Key Files Affected
- `client/src/pages/decks.tsx` -- re-export shim (3 lines)
- `client/src/pages/decks/index.tsx` -- thin shell with tab state (85 lines)
- `client/src/pages/decks/types.ts` -- shared types, constants, utilities (271 lines)
- `client/src/pages/decks/MetaDecksTab.tsx` -- meta decks display and filtering (340 lines)
- `client/src/pages/decks/MetaCardStatsTable.tsx` -- card-level stats table (192 lines)
- `client/src/pages/decks/CounterDeckBuilder.tsx` -- counter-deck suggestion UI (242 lines)
- `client/src/pages/decks/DeckOptimizer.tsx` -- deck optimization UI (370 lines)
- `client/src/pages/decks/DeckDisplay.tsx` -- shared deck card visualization + selection (144 lines)

### Approach
1. **Identify state boundaries:** Each tab likely has its own state. The shared state (e.g., deck data format, card images) should be in a shared module.
2. **Extract one tab at a time:** Start with the smallest/most independent tab (likely MetaDecksTab), verify it works, then proceed.
3. **DeckDisplay shared component:** The deck card visualization likely appears in multiple tabs. Extract it once and reuse.
4. **Preserve tab URLs:** If tabs use URL parameters or hash navigation, ensure that behavior is preserved.

### Risks
- **State coupling between tabs:** Some state may be shared (e.g., selected deck data flowing from Meta to Counter-Deck Builder). Identify these dependencies before splitting.
- **Recharts bundle:** If charts are used in specific tabs, the lazy loading of chart-heavy tabs can be a future optimization (Story 1.10 code splitting).

## Definition of Done

- [x] TD-002 fully addressed
- [x] No file exceeds 400 lines
- [x] decks.tsx shell is under 200 lines
- [x] All 3 tab features work identically to before
- [x] All existing tests pass
- [x] npm run build passes
- [x] Lint passes
- [x] Type check passes
- [x] No visual regressions (pure refactor, no UI changes)
- [x] No new CRITICAL issues introduced
- [x] Code reviewed

## Change Log

| Date | Agent | Change |
|------|-------|--------|
| 2026-02-27 | @po (Pax) | Validated story (10/10). Status: Draft -> Ready. Verdict: GO. |
| 2026-02-27 | @dev (Dex) | Decomposed decks.tsx (1,397 lines) into 8 files in decks/ directory. All ACs met. Build + tests pass. |
| 2026-02-27 | @qa (Quinn) | **QA Gate: PASS.** 7/7 checks passed. Code review: clean decomposition, proper imports, no circular deps, good type safety. Tests: 19/19 pass. Build: clean. AC1-AC5 verified (shell=85 lines, max file=370 lines, all modules exist). No regressions, no performance concerns, no security issues. Pure refactor with zero visual changes. Status: InProgress -> InReview. |
